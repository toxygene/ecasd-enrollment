select CASE WHEN SUM(c.students) > syc.sections * ysgc.capacity THEN "+" ELSE "-" END Scenario, y.name Year, s.name School, g.name Grade, SUM(c.students) Students, syc.sections * ysgc.capacity Seats, CAST(SUM(c.students) as float) / CAST(syc.sections * ysgc.capacity as float) Ratio from classrooms c join school_year_capacity syc on c.year_id = syc.year_id and c.school_id = syc.school_id join years y on y.id = c.year_id join schools s on s.id = c.school_id join grades g on g.id = c.grade_id join year_school_grade_capacity ysgc on c.year_id = ysgc.year_id and c.school_id = ysgc.school_id and c.grade_id = ysgc.grade_id GROUP BY c.year_id, c.school_id, c.grade_id HAVING SUM(c.students) > syc.sections * ysgc.capacity OR SUM(c.students) < (syc.sections - 1) * ysgc.capacity;
